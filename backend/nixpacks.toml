[phases.setup]
# Dependencias del sistema necesarias para procesamiento de PDFs
aptPkgs = ["tesseract-ocr", "tesseract-ocr-spa", "ghostscript", "poppler-utils", "libgl1"]
nixPkgs = ["python311", "python311Packages.pip", "python311Packages.setuptools", "python311Packages.wheel"]
cmds = ["python3 -m venv /opt/venv"]

[phases.install]
cmds = [
  "/opt/venv/bin/pip install --upgrade pip",
  "/opt/venv/bin/pip install -r requirements.txt"
]

[start]
# Railway proporciona $PORT din√°micamente - NUNCA usar puerto fijo
# Usar 1 worker para evitar problemas de memoria y procesos duplicados
cmd = "/opt/venv/bin/gunicorn server:app --bind 0.0.0.0:$PORT --workers 1 --timeout 300 --log-level info --access-logfile - --error-logfile - --preload"
